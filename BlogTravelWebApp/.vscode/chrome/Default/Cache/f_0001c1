function printLogs(e){sminternalconfig.logs&&console.log(e)}function printErrors(e){sminternalconfig.logs&&console.error(e)}function replaceCustomMacros(e,t){var i=e;for(var r in t)i=i.replace(r,t[r]);return i}function getShortString(e,t){return e.length>=t&&(e=e.substring(0,t-3),e+="EOS"),e}function smCreateObjectContainsValues(e,t){var i={};for(var r in e)0==r.indexOf(t)&&(i[r]=e[r]);return i}function createSessionId(e){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=i.charAt(Math.floor(Math.random()*i.length));return t}function smConvertObjectToString(e){for(var t="",i=Object.keys(e),r=0;r<i.length;r++)t=t+i[r]+"="+e[i[r]]+"&";return t}function getServingScenarioType(){try{if(window.top==window)return"OnPage";for(var e=window;e.parent!=e;){if(e.parent.document.domain!=e.document.domain)return"CrossDomainIframe";e=e.parent}return"SameDomainIframe"}catch(e){}return"CrossDomainIframe"}function smCallURL(e){printLogs("Start sending request: "+e);try{var t=e;t=getShortString(t,sminternalconfig.maxUrlSize);var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src=t;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(i,r),printLogs("Finished sending request: "+e)}catch(t){smcounters.smLogicErrorsCollection=smcounters.smLogicErrorsCollection+" smCallURL:"+t,printErrors("Error while get smCallURL , url: "+e+", error: "+t)}}function smReplacePixelMacros(e,t){var i=e;i=replaceCustomMacros(i,smMacrosList);var r={};for(var n in smTagsObjects[t])r["sm_tag_"+n]=smTagsObjects[t][n];return i=replaceCustomMacros(i,r)}function playerCourseIntoItself(e){var t=document.getElementById(e);t.outerHTML="",delete t}function smReportThirdPartyPixel(e,t){try{if("IMPRESSION"==e&&0==smoperational.impressionPixel.indexOf("http"))smCallURL(i=smReplacePixelMacros(smoperational.impressionPixel,t));else if("COMPLETE"==e&&0==smoperational.completePixel.indexOf("http"))smCallURL(i=smReplacePixelMacros(smoperational.completePixel,t));else if("AD_CLICK"==e&&0==smoperational.clickPixel.indexOf("http")){var i=smReplacePixelMacros(smoperational.clickPixel,t);smCallURL(i)}}catch(e){SMreportEvent("LOGIC_ERROR","smReportThirdPartyPixel:"+e)}}function updatesmTagsObjects(e,t){"IMPRESSION"==t?(smTagsObjects[e].imptime=(new Date).getTime(),smTagsObjects[e].impressions++,smTagsObjects[e].latency=smTagsObjects[e].imptime-smTagsObjects[e].starttime):"COMPLETE"==t?(smTagsObjects[e].completes++,smTagsObjects[e].latency=(new Date).getTime()-smTagsObjects[e].imptime):"AD_PLAY"==t?smTagsObjects[e].latency=(new Date).getTime()-smTagsObjects[e].starttime:"AD_VERIFY"==t?(smTagsObjects[e].verifys++,smTagsObjects[e].latency=(new Date).getTime()-smTagsObjects[e].imptime):"AD_REQUEST"==t?(smTagsObjects[e].starttime=(new Date).getTime(),smTagsObjects[e].requests++,smTagsObjects[e].latency=0,1==smTagsObjects[e].order&&smcounters.breakIndex++):"AD_ERROR"==t&&(smTagsObjects[e].errors++,smTagsObjects[e].latency=(new Date).getTime()-smTagsObjects[e].starttime)}function initViewabilityStatus(){try{return smViewability.percentViewable=$sf.ext.inViewPercentage(),smViewability.measureType="safeFrame",void(smViewability.percentViewable>50&&"visible"==smoperational.visibilityState&&(smViewability.viewability=!0))}catch(e){}if(document.getElementById(sminternalconfig.playerContainer))try{var e=new smOpenAdViewability,t=document.getElementById(sminternalconfig.playerContainer);return e.checkViewability(t,function(e){smViewability.percentViewable=e.percentViewable,smViewability.measureType="viewability"}),void(smViewability.percentViewable>50&&"visible"==smoperational.visibilityState&&(smViewability.viewability=!0))}catch(e){smViewability.measureType="not measurable",smViewability.measureStatus="not measurable"}}function smViewSf(){var e=$sf.ext.inViewPercentage();return smViewability.percentViewable=e,e}function smViewReg(){var e,t=new smOpenAdViewability,i=document.getElementById(sminternalconfig.playerContainer);return t.checkViewability(i,function(t){e=t.percentViewable,smViewability.percentViewable=e}),e}function smCheckViewabilityStatus(){var e=-1;return"not measurable"==smViewability.measureType?e:("unknown"==smViewability.measureType&&initViewabilityStatus(),"safeFrame"==smViewability.measureType?e=smViewSf():"viewability"==smViewability.measureType?e=smViewReg():void 0)}function beautifyAreWeGotViewability(){return res={totalViewableTime:0,viewable:0,timeFromImp:0,visible:0,inFocus:0,percentViewable:0},res.totalViewableTime=Math.round(smViewability.totalViewable*smViewability.viewabilityCheckInterval/100)/10,res.viewable=smViewability.sentevent,res.timeFromImp=Math.round(smViewability.totalTimeAd*smViewability.viewabilityCheckInterval/100)/10,res.inFocus="visible"==smoperational.visibilityState,res.visible=1==smViewability.viewability?"visible":"hidden",res.percentViewable=smViewability.percentViewable,res}function smPlacementView(){if(smViewability.totalTimePlacement++,"visible"==smoperational.visibilityState){var e=smCheckViewabilityStatus(),t=Math.max(Math.min(e,100),0);smViewability.SumViewablePlacement=smViewability.SumViewablePlacement+t,currentStatus=t>50,smViewability.viewability=currentStatus}}function smAdView(){smViewability.totalTimeAd++;var e=!1;if("visible"==smoperational.visibilityState){var t=smCheckViewabilityStatus();e=Math.max(Math.min(t,100),0)>50,smViewability.viewability=e}1==e?(smViewability.totalViewable++,smViewability.viewable2Seconds++):0==e&&(smViewability.viewable2Seconds=0),2e3/smViewability.viewabilityCheckInterval<=smViewability.viewable2Seconds&&0==smViewability.sentevent&&(smViewability.sentevent=1,SMreportEvent("VIEWABILITY","",smViewability.currentTagId))}function placementViewSummary(e){var t=Math.round(smViewability.SumViewablePlacement/smViewability.totalTimePlacement);return e&&(smViewability.SumViewablePlacement=0,smViewability.totalTimePlacement=0),t}function smUpdatemeasureStatus(){"unknown"!=smViewability.measureType&&("not measurable"!=smViewability.measureType?"hidden"==smoperational.visibilityState?smViewability.measureStatus="hidden":1==smViewability.viewability?smViewability.measureStatus="viewable":"visible"==smoperational.visibilityState&&(smViewability.measureStatus="visible"):smViewability.measureStatus="not measurable")}function SMreportEvent(e,t,i){var r="";t&&(r+=t),"LOAD"==e&&(r="network_latency:"+smoperational.latencyNetwork,initViewabilityStatus(),"safeFrame"!=smViewability.measureType&&"viewability"!=smViewability.measureType||(smViewability.startMeasurePlacement=setInterval(smPlacementView,smViewability.viewabilityCheckIntervalPlacement))),"IMPRESSION"==e&&(smViewability.startMeasureAd=setInterval(smAdView,smViewability.viewabilityCheckInterval),smViewability.currentTagId=i,smViewability.totalViewable=0,smViewability.viewable2Seconds=0,smViewability.sentevent=0,smViewability.totalTimeAd=0),"COMPLETE"==e&&smViewability.currentTagId==i&&clearInterval(smViewability.startMeasureAd),smReportThirdPartyPixel(e,i);try{var n=JSON.stringify(smMacrosList);smUpdatemeasureStatus();var a,s,o,m=smViewability.measureStatus,l=beautifyAreWeGotViewability(),c="",p=-1,d=((new Date).getTime(),0),u=smoperational.lastEvent;try{var b=Math.round(((new Date).getTime()-smoperational.startTime)/100)/10;s="s:"+smoperational.loopnumber+",servingScenario:"+smoperational.servingScenario+smMembers.screen,i&&(updatesmTagsObjects(i,e),d=smTagsObjects[i].order,c="("+i+")",p=smTagsObjects[i].latency,o=JSON.stringify(l)),smcounters.eventsSentLog=smcounters.eventsSentLog+e+c+":"+b+",";var g=(a=smcounters.eventsSentLog).length;g>250&&(a=a.substring(g-250,g))}catch(e){r=r+"error: "+e+" ",smcounters.smLogicErrorsCollection=smcounters.smLogicErrorsCollection+" SMreportEvent1:"+e,printErrors("Error while msg:"+e)}finally{p>smcounters.latencyLimit&&(p=smcounters.latencyLimit)}"TIMER"==e&&(b=60*smoperational.timerCounter);try{s=getShortString(s,2*sminternalconfig.maxParamSize)}catch(e){smcounters.smLogicErrorsCollection=smcounters.smLogicErrorsCollection+" dynamicThree:"+e}randomNumber=Math.floor(100*Math.random());var y=0;smEventsDictionary[e]&&(y=smEventsDictionary[e]),""!=smcounters.smLogicErrorsCollection&&(r+=smcounters.smLogicErrorsCollection);try{r=getShortString(r,2*sminternalconfig.maxParamSize),r=encodeURIComponent(r)}catch(e){smcounters.smLogicErrorsCollection=smcounters.smLogicErrorsCollection+" msgEnc:"+e}randomNumber<y&&(smcounters.smLogicErrorsCollection="",smCallURL(smoperational.eventUrl+"?eventType="+e+"&"+smStringParams+"samplingPercent="+y+"&randomNumber="+randomNumber+"&breakIndex="+smcounters.breakIndex+"&smTagId="+i+"&hftResponseType="+smoperational.hftResponseType+"&tagPriority="+d+"&smserveflash="+smcounters.serveFlash+"&protocol="+smoperational.protocol+"&smlatency="+p+"&visibility="+smViewability.viewability+":"+smoperational.visibilityState+":"+smoperational.servingScenario+"&clientVersion="+smoperational.clientVersion+"&waterfallString="+smoperational.waterfallStr+"&sessionId="+smoperational.sessionId+"&initts="+b+"&hftnumber="+smcounters.hftNumber+"&docReferrer="+smMembers.docReferrer+"&topLocation="+smMembers.topLocation+"&smwidth="+smoperational.width+"&smheight="+smoperational.height+"&message="+r+"&previouseventtype="+u+"&viewability="+m+"&smdynamic3="+s+"&smdynamic4="+o+"&smdynamic2="+a+"&smdynamic1="+n)),smcounters.lastEventTS=(new Date).getTime(),smEventsDictionary[e]&&(smoperational.lastEvent=e),printLogs("%c event= "+e+" tagId= "+i+" breakIndex= "+smcounters.breakIndex+" order= "+d+" time from start= "+b,"color: #0000FF")}catch(i){printErrors("Error while report event. event="+e+", msg="+t+", sampling="+y+", randomNumber="+randomNumber+", error="+i),smcounters.smLogicErrorsCollection=smcounters.smLogicErrorsCollection+" SMreportEvent2:"+i}}function getFlashVersion(){try{try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{e.AllowScriptAccess="always"}catch(e){return"6,0,0"}}catch(e){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(e){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(e){}}return"0,0,1"}function smConvertStringToObject(e,t){var i=[],r=[];-1!==e.indexOf("&")&&(i=e.split("&")),-1!==e.indexOf("?")&&(r=i[0].split("?")),-1!==e.indexOf("#")&&(r=i[0].split("#")),i.push(r[1]),i.shift();for(var n=0;n<i.length;n++){var a=i[n].split("=");t[a[0]]=a[1].toString()}}function smGetVisibilityState(){try{var e,t;void 0!==document.hidden?(t="visibilitychange",e="visibilityState"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozVisibilityState"):void 0!==document.msHidden?(t="msvisibilitychange",e="msVisibilityState"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitVisibilityState"),smoperational.visibilityState=document[e],document.addEventListener(t,function(){smoperational.visibilityState=document[e],"DYNAMIC"!=smoperational.hftResponseType||smoperational.isUserInteraction||SMreportEvent("UI",smoperational.visibilityState)},!1)}catch(e){smoperational.visibilityState="error"}}function smGetSessionSummary(){var e=0,t=0,i=0,r=0,n=0;for(var a in smTagsObjects)e+=smTagsObjects[a].requests,t+=smTagsObjects[a].impressions,i<smTagsObjects[a].impressions&&(i=smTagsObjects[a].impressions,r=smTagsObjects[a].requests,n=a);return"totalRequests="+e+" totalImpressions="+t+" bestTag="+n+" req="+r+" imps="+i}function smOpenAdViewability(){try{var e=new OAVGeometryViewabilityCalculator,t={percentObscured:0,percentViewable:0,acceptedViewablePercentage:50,viewabiltyStatus:!1};this.checkViewability=function(e,r){i(e)&&(t.viewabiltyStatus=!0),r(t)};var i=function(e){var i=e.getBoundingClientRect();i.width,i.height;return!0!==n(e)&&(!0!==a(e)&&(r(e),!(t.percentViewable&&t.percentViewable<t.acceptedViewablePercentage)&&!!t.percentViewable))},r=function(i){t.percentObscured=t.percentObscured||0;var r=e.getViewabilityState(i,window);return r.error||(t.percentViewable=r.percentViewable-t.percentObscured),r},n=function(e){var t=window.getComputedStyle(e,null),i=t.getPropertyValue("visibility"),r=t.getPropertyValue("display");return"hidden"==i||"none"==r},a=function(e){var i=e.getBoundingClientRect(),r=i.left+12,n=i.right-12,a=i.top+12,o=i.bottom-12,m=Math.floor(i.left+i.width/2),l=Math.floor(i.top+i.height/2),c=[{x:r,y:a},{x:m,y:a},{x:n,y:a},{x:r,y:l},{x:m,y:l},{x:n,y:l},{x:r,y:o},{x:m,y:o},{x:n,y:o}];for(var p in c)if(c[p]&&c[p].x>=0&&c[p].y>=0&&(elem=document.elementFromPoint(c[p].x,c[p].y),null!=elem&&elem!=e&&!e.contains(elem)&&(overlappingArea=s(i,elem.getBoundingClientRect()),overlappingArea>0&&(t.percentObscured=100*s(i,elem.getBoundingClientRect()),t.percentObscured>t.acceptedViewablePercentage))))return t.percentViewable=100-t.percentObscured,!0;return!1},s=function(e,t){var i=e.width*e.height;return Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top))/i}}catch(e){smOVAexeption="smOpenAdViewability="+e}}function OAVGeometryViewabilityCalculator(){this.getViewabilityState=function(r,n){try{var a,s=e();if(s.area==1/0)return{error:"Failed to determine viewport"};var o=r.getBoundingClientRect(),m=o.width*o.height,l=t(window.top),c=i(r,n);return s.area/m<.5?a=Math.floor(100*s.area/m):(c.bottom>l.height&&(c.height-=c.bottom-l.height),c.top<0&&(c.height+=c.top),c.left<0&&(c.width+=c.left),c.right>l.width&&(c.width-=c.right-l.width),a=Math.floor(c.width*c.height*100/m)),{clientWidth:l.width,clientHeight:l.height,objTop:o.top,objBottom:o.bottom,objLeft:o.left,objRight:o.right,percentViewable:a}}catch(e){smOVAexeption="this.getViewabilityState="+e}};var e=function(){try{for(var e=t(window),i=e.area,r=window;r!=window.top;)r=r.parent,viewPortSize=t(r),viewPortSize.area<i&&(i=viewPortSize.area,e=viewPortSize);return e}catch(e){smOVAexeption="getMinViewPortSize="+e}},t=function(e){try{var t={width:1/0,height:1/0,area:1/0};return!isNaN(e.document.body.clientWidth)&&e.document.body.clientWidth>0&&(t.width=e.document.body.clientWidth),!isNaN(e.document.body.clientHeight)&&e.document.body.clientHeight>0&&(t.height=e.document.body.clientHeight),e.document.documentElement&&e.document.documentElement.clientWidth&&!isNaN(e.document.documentElement.clientWidth)&&(t.width=e.document.documentElement.clientWidth),e.document.documentElement&&e.document.documentElement.clientHeight&&!isNaN(e.document.documentElement.clientHeight)&&(t.height=e.document.documentElement.clientHeight),e.innerWidth&&!isNaN(e.innerWidth)&&(t.width=Math.min(t.width,e.innerWidth)),e.innerHeight&&!isNaN(e.innerHeight)&&(t.height=Math.min(t.height,e.innerHeight)),t.area=t.height*t.width,t}catch(e){smOVAexeption="getViewPortSize="+e}},i=function(e,t){try{var n=t,a=t.parent,s={width:0,height:0,left:0,right:0,top:0,bottom:0};if(e){var o=r(e,t);if(o.width=o.right-o.left,o.height=o.bottom-o.top,s=o,n!=a){var m=i(n.frameElement,a);m.bottom<s.bottom&&(m.bottom<s.top&&(s.top=m.bottom),s.bottom=m.bottom),m.right<s.right&&(m.right<s.left&&(s.left=m.right),s.right=m.right),s.width=s.right-s.left,s.height=s.bottom-s.top}}return s}catch(e){smOVAexeption="getAssetVisibleDimension="+e}},r=function(e,t){try{var i=t,n=t.parent,a={left:0,right:0,top:0,bottom:0};if(e){var s=e.getBoundingClientRect();i!=n&&(a=r(i.frameElement,n)),a={left:s.left+a.left,right:s.right+a.left,top:s.top+a.top,bottom:s.bottom+a.top}}return a}catch(e){smOVAexeption="getPositionRelativeToViewPort="+e}}}function smGetStaticEnvVariables(){try{smoperational.protocol=location.protocol}catch(e){smoperational.protocol="error"}smoperational.protocol=smoperational.protocol.replace(/:$/,""),getFlashVersion().split(",").shift()<11&&(smcounters.serveFlash=0);try{smMembers.topLocation=decodeURIComponent(top.location.href)}catch(e){smMembers.topLocation=null}if(!smMembers.topLocation||-1==smMembers.topLocation.indexOf("."))try{smMembers.topLocation=decodeURIComponent(window.location.href)+"&smLoc=window"}catch(e){printErrors("Error while init smdocReferrer from window.location.href"+e)}try{smMembers.docReferrer=decodeURIComponent(document.referrer)}catch(e){printErrors("Error while init smdocReferrer. "+e),smMembers.docReferrer="undefined"}if(smMembers.topLocation.indexOf("printsmlogs")>-1){sminternalconfig.logs=!0;for(key in smEventsDictionary)smEventsDictionary[key]=100}try{var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,i=screen.availHeight,r=screen.height,n=screen.width,a=screen.availWidth;smMembers.screen=" doc:"+e+"x"+t+",av:"+a+"x"+i+",res:"+n+"x"+r}catch(e){smMembers.screen="error"}}function smHandleMacros(){try{var e={},t=document.getElementById("sm_main_script");if(t&&smConvertStringToObject(t.src,e),e.cv&&delete e.cv,e.cname&&(sminternalconfig.domain=decodeURIComponent(e.cname),delete e.cname),e.protocol&&(sminternalconfig.protocol=decodeURIComponent(e.protocol),delete e.protocol),e.eventbase&&(sminternalconfig.eventbase=decodeURIComponent(e.eventbase),delete e.eventbase),e.serve_flash&&(smcounters.serveFlash=e.serve_flash,delete e.serve_flash),e.player_url&&(smoperational.paramPlayerUrl=decodeURIComponent(e.player_url),smoperational.clientVersion=smoperational.clientVersion+"_"+smoperational.paramPlayerUrl,delete e.player_url),e.click&&(0==e.click.indexOf("http")&&(smoperational.click=decodeURIComponent(e.click)),delete e.click),e.cb&&(smoperational.sessionId=e.cb,delete e.cb),e.smQAmode){for(i in smEventsDictionary)smEventsDictionary[i]=100;delete e.smQAmode}smMacrosList=smCreateObjectContainsValues(e,"sm_macro_");for(n in e)0==n.indexOf("sm_macro_")&&delete e[n]}catch(e){SMreportEvent("LOGIC_ERROR","smHandleMacros:"+e)}var r=sminternalconfig.protocol+"://"+e.server+"."+sminternalconfig.domain+"/"+sminternalconfig.eventbase;smoperational.eventUrl=r+".evt",smoperational.hftUrl=r+".hft",delete e.server,printLogs("smMacrosObject= "+JSON.stringify(e));try{e.declaredurl=decodeURIComponent(e.declaredurl)}catch(t){e.declaredurl="undefined"}-1==e.declaredurl.indexOf(".")&&(e.declaredurl=smHandleEmptyReportUrl());for(var n in e)e[n]=getShortString(e[n],sminternalconfig.maxParamSize);e.declaredurl=smHandleLongEncodingUrls(e.declaredurl);try{smStringParams=smConvertObjectToString(e)}catch(e){smStringParams="",smStringParams=t.src.slice(t.src.indexOf("?")+1)+"&",SMreportEvent("LOGIC_ERROR",e)}}function smHandleEmptyReportUrl(){var e="";try{var t={};smMembers.docReferrer&&smMembers.docReferrer.indexOf(".")>-1&&(smMembers.docReferrer.indexOf("?")>-1||smMembers.docReferrer.indexOf("#")>-1)&&smConvertStringToObject(smMembers.docReferrer,t),smMembers.topLocation&&smMembers.topLocation.indexOf(".")>-1&&(smMembers.topLocation.indexOf("?")>-1||smMembers.topLocation.indexOf("#")>-1)&&smConvertStringToObject(smMembers.topLocation,t),t.url?e=t.url:t.referrer?e=t.referrer:t.p&&(e=t.p),e=e.replace('unescape("',""),e=e.replace('")',"")}catch(t){e="undefined"}finally{return e}}function smHandleLongEncodingUrls(e){var t=encodeURIComponent(e),i=Math.floor(sminternalconfig.maxParamSize/5);return t.length>2*e.length&&(e=e.substring(0,i)),encodeURIComponent(e)}function initMembers(){printLogs("Start init  members"),smGetStaticEnvVariables(),smHandleMacros(),smGetVisibilityState();var e=smoperational.sessionId.length;if(e<26){var t=26-e;smoperational.sessionId=smoperational.sessionId+"_"+createSessionId(t)}smoperational.servingScenario=getServingScenarioType();for(var i in smMembers)smMembers[i]=getShortString(smMembers[i],sminternalconfig.maxParamSize);smMembers.docReferrer=smHandleLongEncodingUrls(smMembers.docReferrer),smMembers.topLocation=smHandleLongEncodingUrls(smMembers.topLocation),smoperational.timerInterval=setInterval(function(){smoperational.timerCounter++;var e=smGetSessionSummary();SMreportEvent("TIMER","view="+placementViewSummary(!0)+" "+e),smoperational.timerCounter>30&&clearInterval(smoperational.timerInterval)},6e4)}function getHftResponseFromServer(e){smoperational.HftStartTime=(new Date).getTime(),smcounters.hftNumber++,smCallURL(smoperational.hftUrl+"?"+smStringParams+"smserveflash="+smcounters.serveFlash+"&protocol="+smoperational.protocol+"&smlistsize="+smcounters.listsize+"&hftnumber="+smcounters.hftNumber+"&visibility="+smViewability.viewability+":"+smoperational.visibilityState+":"+smoperational.servingScenario+e+"&docReferrer="+smMembers.docReferrer+"&topLocation="+smMembers.topLocation+"&clientVersion="+smoperational.clientVersion+"&randomNumber="+randomNumber)}function buildHftResObject(e){function t(){smoperational.isUserInteraction=!0,s.removeEventListener("mouseenter",t,!1)}function i(){SMreportEvent("PLAYER_CLICK",""),s.removeEventListener("click",i,!1)}printLogs(JSON.stringify(e));var r=0,n=100;try{e.executionTime&&(r=e.executionTime,n=50)}catch(e){}if(smoperational.latencyNetwork=(new Date).getTime()-smoperational.HftStartTime-r,smoperational.latencyNetwork<n&&smcounters.hftNumber<2)return smoperational.clientVersion=smoperational.clientVersion+"low network latency:"+smoperational.latencyNetwork+",exec time:"+r,void getHftResponseFromServer("&responseType=STATIC");if(!document.getElementById(sminternalconfig.playerContainer)){var a=document.createElement("div");a.id=sminternalconfig.playerContainer,a.style.width="300px",a.style.height="250px",document.body.appendChild(a)}var s=document.getElementById(sminternalconfig.playerContainer);if(s.addEventListener("mouseenter",t,!1),s.addEventListener("click",i,!1),smMembers.sessionTTL=1e3*e.hftRefresh,smoperational.hftResponseType=e.responseType,smoperational.waterfallStr=e.waterfallId,smoperational.impressionPixel=e.impressionPixel,smoperational.clickPixel=e.clickPixel,smoperational.completePixel=e.completePixel,smoperational.loop=e.loopNumber,smoperational.width=e.width,smoperational.height=e.height,clearInterval(smcounters.hftRefreshInterval),"STATIC"!==e.responseType)smcounters.hftRefreshInterval=setInterval(function(){getHftResponseFromServer("")},smMembers.sessionTTL);else{clearInterval(smoperational.timerInterval);var o=smGetSessionSummary();SMreportEvent("SESSION_END","loop="+smoperational.loopnumber+" "+o)}smMainResponse=e,e.client_dilution_percent&&1==smcounters.hftNumber?(smEventsDictionary.AD_ERROR=e.client_dilution_percent,smEventsDictionary.AD_REQUEST=e.client_dilution_percent):(smEventsDictionary.AD_ERROR=10,smEventsDictionary.AD_REQUEST=10);var m=(new Date).getTime();smCallURL((0==smoperational.paramPlayerUrl.indexOf("http")?smoperational.paramPlayerUrl:e.playerRecord.url)+"?cb="+m)}function hftBackupLogic(){if(sminternalconfig.currentHftFail++,sminternalconfig.maxHftFail>=sminternalconfig.currentHftFail){var e=1e3*sminternalconfig.currentHftFail*(10+Math.floor(20*Math.random()));setTimeout(getHftResponseFromServer,e)}}function parseHftResponseEvent(e){var t="";try{printLogs("Got HFT event from server. Start parsing HFT response. Status="+(t=e.responseStatus)),"STATIC_CONFIGURATION"==e.hftDecision&&e.playerRecord.id<2?hftBackupLogic():buildHftResObject(e),printLogs("Finished parse server HFT response. Status="+t)}catch(e){printErrors("Exception while parsing server HFT response. loading defaults. "+e),SMreportEvent("LOGIC_ERROR","Failed to parse erver HFT response. err="+e)}printLogs("Start init SR player immediately after getting response from server")}var smMainClientVersion="5.0.6.5",sminternalconfig={logs:!1,maxParamSize:200,maxUrlSize:2e3,domain:"selectmedia.asia",protocol:"https",eventbase:"cpd",playerContainer:"sm_player",maxHftFail:3,currentHftFail:0},smEventsDictionary={PRE_INIT:100,CDN_CHECK:10,LOAD:100,UI:10,LOGIC_ERROR:100,PLAYER_CLICK:100,SETUP_ERROR:100,HFT:10,TIMER:10,PLAYER_ERROR:100,SESSION_END:100,AD_REQUEST:10,AD_PLAY:1,AD_ERROR:10,IMPRESSION:100,AD_VERIFY:100,COMPLETE:100,AD_CLICK:100,VIEWABILITY:100},smMacrosList={},smMainScript="",smPlayer=null,smMainResponse="",smoperational={cpmWeight:.8,paramPlayerUrl:"",protocol:"undefined",clientVersion:smMainClientVersion,responseType:"",loopnumber:0,loop:0,lastEvent:"",startTime:(new Date).getTime(),HftStartTime:(new Date).getTime(),adTagId:null,tagPriority:0,waterfallStr:"",hftResponseType:"",eventUrl:"",hftUrl:"",sessionId:"",visibilityState:"unknown",impressionPixel:"",clickPixel:"",completePixel:"",click:"",isUserInteraction:!1,servingScenario:"",width:"",height:"",playerVersion:"",latencynetwork:0,timerInterval:0,timerCounter:0},smcounters={breakIndex:0,lastTag:"",lastEventTS:(new Date).getTime(),eventsSentLog:"",serveFlash:1,latencyLimit:12e4,listsize:0,hftNumber:0,hftNumberInit:0,smLogicErrorsCollection:"",hftRefreshInterval:0},smStringParams="",smMembers={screen:"",docReferrer:"",topLocation:"",sessionTTL:3e5},smViewability={viewability:"unknown",measureType:"unknown",measureStatus:"unknown",viewabilityCheckInterval:250,percentViewable:0,startMeasureAd:0,currentTagId:0,viewable2Seconds:0,sentevent:0,totalTimeAd:0,totalViewable:0,startMeasurePlacement:0,viewabilityCheckIntervalPlacement:1e3,SumViewablePlacement:0,totalTimePlacement:0},smTagsObjects={},smOVAexeption="";try{initMembers(),SMreportEvent("PRE_INIT",""),getHftResponseFromServer(""),printLogs("*** Finished SelectMedia main script ***")}catch(e){printErrors("Error while executing SelectMedia main script. "+e)}